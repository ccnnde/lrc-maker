import{A as u,s as F,j as a,c as G,D as V,d as E,e as m,f as H,g as L,h as I,i as K,a as J,S as N,k as M,l as W}from"./index-0wKaPtT5.js";import{l as $}from"./lrc-file-name-sR0E2KGQ.js";const T=React.memo(({syncMode:n,setSyncMode:t,lrcDispatch:d,prefState:c})=>{const[l,b]=React.useState(),[p,S]=React.useState(),i=React.useCallback(()=>{t(g=>g===h.select?h.highlight:h.select)},[t]),k=React.useCallback(()=>{d({type:u.getState,payload:g=>{const R=F(g,c);b(D=>(D&&URL.revokeObjectURL(D),URL.createObjectURL(new Blob([R],{type:"text/plain;charset=UTF-8"})))),S($(g.info))}})},[d,c]),x=n===h.select?"select":"highlight",C=["aside-button","syncmode-button","ripple","glow ",x].join(E.space);return a.jsxs("aside",{className:"aside-panel",children:[a.jsx("button",{className:C,onClick:i,"aria-label":`${x} mode`,children:a.jsx(G,{})}),a.jsx("a",{href:l,download:p,className:"aside-button ripple glow",onClick:k,children:a.jsx(V,{})})]})});T.displayName=T.name;const P=({fixed:n})=>{const t=React.useRef(Symbol(P.name)),[d,c]=React.useState(m.currentTime),[l,b]=React.useState(m.paused),[p,S]=React.useState(m.playbackRate);return React.useEffect(()=>H.sub(t.current,i=>{switch(i.type){case L.pause:{b(i.payload);break}case L.rateChange:{S(i.payload);break}}}),[]),React.useEffect(()=>{const i=[1,10,100,1e3][n]*p;if(l||2*i>60)return I.sub(t.current,k=>{c(k)});{const k=setInterval(()=>{c(m.currentTime)},1e3/(2*i));return()=>{clearInterval(k)}}},[n,l,p]),a.jsx("time",{className:"curser",children:K(d,n)})},q=({sync:n})=>a.jsx("button",{className:"space-button",onClick:n,children:"space"});var h=(n=>(n[n.select=0]="select",n[n.highlight=1]="highlight",n))(h||{});const z=({state:n,dispatch:t})=>{const d=React.useRef(Symbol(z.name)),{selectIndex:c,currentIndex:l,lyric:b}=n,{prefState:p,lang:S}=React.useContext(J);React.useEffect(()=>{t({type:u.info,payload:{name:"tool",value:`${S.app.name} https://lrc-maker.github.io`}})},[t,S]);const[i,k]=React.useState(()=>sessionStorage.getItem(N.syncMode)===1 .toString()?1:0);React.useEffect(()=>{sessionStorage.setItem(N.syncMode,i.toString())},[i]);const x=React.useRef(null),C={0:c,1:l}[i];React.useEffect(()=>{var e;const s=(e=x.current)==null?void 0:e.children[C];s!==void 0&&s.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},[C]),React.useEffect(()=>I.sub(d.current,s=>{t({type:u.refresh,payload:s})}),[t]);const g=React.useCallback(()=>{m.duration&&t({type:u.next,payload:m.currentTime})},[t]),R=React.useCallback((s,e,r)=>{var j;if(!m.duration)return;const o=(j=b[r])==null?void 0:j.time;o!==void 0&&t({type:u.time,payload:m.step(s,e,o)})},[t,b]);React.useEffect(()=>{function s(e){const{code:r,key:o,target:j}=e,f=r||o;if(!W(j)){if(f==="Backspace"||f==="Delete"||f==="Del"){e.preventDefault(),t({type:u.deleteTime,payload:void 0});return}if(r==="Digit0"||o==="0"){e.preventDefault(),R(e,0,c);return}if(r==="Minus"||o==="-"||o==="_"){e.preventDefault(),R(e,-.5,c);return}if(r==="Equal"||o==="+"||o==="="){e.preventDefault(),R(e,.5,c);return}e.metaKey||e.ctrlKey||(r==="Space"||o===" "||o==="Spacebar"?(e.preventDefault(),g()):["ArrowUp","KeyW","KeyJ","Up","W","w","J","j"].includes(f)?(e.preventDefault(),t({type:u.select,payload:y=>y-1})):["ArrowDown","KeyS","KeyK","Down","S","s","K","k"].includes(f)?(e.preventDefault(),t({type:u.select,payload:y=>y+1})):f==="Home"?(e.preventDefault(),t({type:u.select,payload:()=>0})):f==="End"?(e.preventDefault(),t({type:u.select,payload:()=>1/0})):f==="PageUp"?(e.preventDefault(),t({type:u.select,payload:y=>y-10})):f==="PageDown"&&(e.preventDefault(),t({type:u.select,payload:y=>y+10})))}}return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[R,t,c,g]);const D=React.useCallback(s=>{s.stopPropagation();const e=s.target;if(e.classList.contains("line")){const r=Number.parseInt(e.dataset.key,10)||0;t({type:u.select,payload:()=>r})}},[t]),U=React.useCallback(s=>{if(s.stopPropagation(),!m.duration)return;const e=s.target;if(e.classList.contains("line")){const r=Number.parseInt(e.dataset.key,10);R(s,0,r)}},[R]),A=React.useCallback((s,e,r)=>{const o=e===c,j=e===l,f=e>0&&r[e].time<=r[e-1].time,y=Object.entries({line:!0,select:o,highlight:j,error:f}).reduce((w,[v,O])=>(O&&w.push(v),w),[]).join(E.space);return a.jsx(_,{index:e,className:y,line:s,select:o,prefState:p},e)},[c,l,p]),B=p.screenButton?"lyric-list on-screen-button":"lyric-list";return a.jsxs(a.Fragment,{children:[a.jsx("ul",{ref:x,className:B,onClickCapture:D,onDoubleClickCapture:U,children:n.lyric.map(A)}),a.jsx(T,{syncMode:i,setSyncMode:k,lrcDispatch:t,prefState:p}),p.screenButton&&a.jsx(q,{sync:g})]})},_=({line:n,index:t,select:d,className:c,prefState:l})=>{const b=K(n.time,l.fixed),p=M(n.text,l.spaceStart,l.spaceEnd);return a.jsxs("li",{"data-key":t,className:c,children:[d&&a.jsx(P,{fixed:l.fixed}),a.jsx("time",{className:"line-time",children:b}),a.jsx("span",{className:"line-text",children:p})]},t)};export{h as SyncMode,z as Synchronizer};
