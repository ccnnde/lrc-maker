import{a as U,A as u,s as O,S as h,L as j,t as w,j as e,O as G,C as I,D as L,p as E,R as V,b as A,U as B}from"./index-0wKaPtT5.js";import{c as M}from"./gistapi-W_qTkofq.js";import{l as D}from"./lrc-file-name-sR0E2KGQ.js";const r={autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",spellCheck:!1},c=(a,s)=>{const t=((i,d)=>i??d)(s,React.useRef(null));return React.useEffect(()=>{t.current&&(t.current.value=a)},[a,t]),{ref:t,defaultValue:a}},P=({lrcState:a,lrcDispatch:s})=>{const{prefState:m,lang:t,trimOptions:i}=React.useContext(U),d=React.useCallback(o=>{s({type:u.parse,payload:{text:o.target.value,options:i}})},[s,i]),R=React.useCallback(o=>{const{name:l,value:N}=o.target;s({type:u.info,payload:{name:l,value:N}})},[s]),g=O(a,m),f=React.useRef(null),b=React.useCallback(()=>{sessionStorage.setItem(h.editorDetailsOpen,f.current.open.toString())},[]),C=React.useMemo(()=>sessionStorage.getItem(h.editorDetailsOpen)!=="false",[]),n=React.useRef(null),[y,k]=React.useState(void 0),F=React.useCallback(()=>{k(o=>(o&&URL.revokeObjectURL(o),URL.createObjectURL(new Blob([n.current.value],{type:"text/plain;charset=UTF-8"}))))},[]),S=React.useCallback(o=>{if(o.target.files===null||o.target.files.length===0)return;const l=new FileReader;l.addEventListener("load",()=>{s({type:u.parse,payload:{text:l.result,options:i}})}),l.readAsText(o.target.files[0],"UTF-8")},[s,i]),T=React.useCallback(()=>{var o;(o=n.current)==null||o.select(),document.execCommand("copy")},[]),p=React.useMemo(()=>D(a.info),[a.info]),x=React.useMemo(()=>localStorage.getItem(j.token)!==null&&localStorage.getItem(j.gistId)!==null,[]),v=React.useCallback(()=>{setTimeout(()=>{const o=prompt(t.editor.saveFileName,p);o&&M(o,n.current.value).catch(l=>{w.pub({type:"warning",text:l.message})})},500)},[p,t]);return e.jsxs("div",{className:"app-editor",children:[e.jsxs("details",{ref:f,open:C,onToggle:b,children:[e.jsx("summary",{children:t.editor.metaInfo}),e.jsxs("section",{className:"app-editor-infobox",onBlur:R,children:[e.jsx("label",{htmlFor:"info-ti",children:"[ti:"}),e.jsx("input",{id:"info-ti",name:"ti",placeholder:t.editor.title,...r,...c(a.info.get("ti")||"")}),e.jsx("label",{htmlFor:"info-ti",children:"]"}),e.jsx("label",{htmlFor:"info-ar",children:"[ar:"}),e.jsx("input",{id:"info-ar",name:"ar",placeholder:t.editor.artist,...r,...c(a.info.get("ar")||"")}),e.jsx("label",{htmlFor:"info-ar",children:"]"}),e.jsx("label",{htmlFor:"info-al",children:"[al:"}),e.jsx("input",{id:"info-al",name:"al",placeholder:t.editor.album,...r,...c(a.info.get("al")||"")}),e.jsx("label",{htmlFor:"info-al",children:"]"})]})]}),e.jsxs("section",{className:"editor-tools",children:[e.jsxs("label",{className:"editor-tools-item ripple",title:t.editor.uploadText,children:[e.jsx("input",{hidden:!0,type:"file",accept:"text/*, .txt, .lrc",onChange:S}),e.jsx(G,{})]}),e.jsx("button",{className:"editor-tools-item ripple",title:t.editor.copyText,onClick:T,children:e.jsx(I,{})}),e.jsx("a",{className:"editor-tools-item ripple",title:t.editor.downloadText,href:y,onClick:F,download:p,children:e.jsx(L,{})}),e.jsx("a",{title:t.editor.saveToGist,href:x?void 0:E(V.gist),className:"editor-tools-item ripple",onClick:x?v:void 0,children:e.jsx(A,{})}),e.jsx("a",{title:t.editor.utils,href:"/lrc-utils/",className:"editor-tools-item ripple",children:e.jsx(B,{})})]}),e.jsx("textarea",{className:"app-textarea","aria-label":"lrc input here",onBlur:d,...r,...c(g,n)})]})};export{P as Eidtor};
