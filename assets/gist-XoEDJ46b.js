import{a as M,L as c,S as _,t as d,A as S,j as e,G as y,m as B,n as z,p as G,R as C,E as J,o as P}from"./index-0wKaPtT5.js";import{a as V,b as q,g as H,G as T,d as K}from"./gistapi-W_qTkofq.js";const U="https://github.com/settings/tokens/new?scopes=gist&description=https://lrc-maker.github.io",L={autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",spellCheck:!1},X=({lrcDispatch:g,langName:f})=>{const{lang:n,trimOptions:p}=React.useContext(M),[u,k]=React.useState(()=>localStorage.getItem(c.token)),[a,h]=React.useState(()=>localStorage.getItem(c.gistId)),[x,F]=React.useState(void 0),[r,v]=React.useState(()=>JSON.parse(localStorage.getItem(c.gistFile))),m=React.useMemo(()=>JSON.parse(sessionStorage.getItem(_.ratelimit)),[]),j=React.useCallback(t=>{t.preventDefault();const l=t.target.elements.namedItem("token").value;localStorage.setItem(c.token,l),k(l)},[]),b=React.useCallback(()=>{V().then(t=>{localStorage.setItem(c.gistId,t.id),h(t.id)}).catch(t=>{d.pub({type:"warning",text:t.message})})},[]),N=React.useCallback(t=>{t.preventDefault();const l=t.target.elements.namedItem("gist-id").value;localStorage.setItem(c.gistId,l),h(l),q().catch(o=>{d.pub({type:"warning",text:o.message})})},[]);React.useEffect(()=>{a!==null||u===null||"HTMLDataListElement"in window&&H().then(t=>{F(t.filter(s=>s.description===T.description&&T.fileName in s.files).map(({id:s})=>s))}).catch(t=>{d.pub({type:"warning",text:t.message})})},[u,a]),React.useEffect(()=>{a!==null&&K().then(t=>{if(t===null)return;const s=Object.values(t.files).filter(i=>i.filename.endsWith(".lrc"));localStorage.setItem(c.gistFile,JSON.stringify(s,["filename","content","truncated","raw_url"])),v(s)}).catch(t=>{d.pub({type:"warning",text:t.message})})},[a]);const I=React.useCallback(t=>{const s=t.target;if(!("key"in s.dataset))return;const i=Number.parseInt(s.dataset.key,10),l=r==null?void 0:r[i];l&&(l.truncated?fetch(l.raw_url).then(async o=>o.text()).then(o=>{g({type:S.parse,payload:{text:o,options:p}})}).catch(o=>{d.pub({type:"warning",text:o.message})}):g({type:S.parse,payload:{text:l.content,options:p}}))},[r,g,p]),w=React.useCallback(()=>{h(null),k(null)},[]),R=React.useMemo(()=>{if(m===null)return!1;const t=new Intl.DateTimeFormat(f,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}).format(new Date(Number.parseInt(m["x-ratelimit-reset"],10)*1e3));return e.jsxs("section",{className:"ratelimit",children:[e.jsxs("p",{children:["ratelimit-limit: ",m["x-ratelimit-limit"]]}),e.jsxs("p",{children:["ratelimit-remaining: ",m["x-ratelimit-remaining"]]}),e.jsxs("p",{children:["ratelimit-reset: ",t]})]})},[m,f]),O=React.useCallback(()=>a!==null&&u!==null?e.jsxs("details",{className:"gist-details",children:[e.jsx("summary",{children:n.gist.info}),e.jsxs("section",{className:"gist-bar",children:[e.jsxs("section",{className:"gist-info",children:[e.jsxs("p",{children:["Gist id: ",e.jsx("a",{href:`https://gist.github.com/${a}`,target:"_blank",rel:"noopener noreferrer",className:"link",children:a})]}),e.jsx("button",{className:"button",onClick:w,children:n.gist.clearTokenAndGist})]}),R]})]}):null,[a,u,n.gist.info,n.gist.clearTokenAndGist,w,R]),E=React.useMemo(()=>{if(u===null)return e.jsxs("section",{className:"new-token",children:[e.jsx(y,{}),e.jsx("p",{className:"new-token-tip-text",children:n.gist.newTokenTip}),e.jsx("a",{className:"new-token-tip button",target:"_blank",rel:"noopener noreferrer",href:U,children:n.gist.newTokenButton}),e.jsxs("form",{className:"new-token-form",onSubmit:j,children:[e.jsx("label",{htmlFor:"github-token",children:"Token:"}),e.jsx("input",{type:"text",className:"new-token-input",id:"github-token",name:"token",minLength:40,maxLength:40,required:!0,...L},"token"),e.jsx("input",{className:"new-token-submit button",type:"submit"})]})]})},[u,n.gist.newTokenTip,n.gist.newTokenButton,j]),A=React.useMemo(()=>{if(a===null){const t=i=>e.jsx("option",{value:i},i),s=x&&e.jsxs("datalist",{id:"gist-list",children:[x.map(i=>t(i)),";"]});return e.jsxs("section",{className:"get-gist-id",children:[e.jsx(y,{}),e.jsx("p",{className:"gist-id-tip-text",children:n.gist.newGistTip}),e.jsx("button",{className:"create-new-gist button",onClick:b,children:n.gist.newGistRepoButton}),e.jsxs("form",{className:"gist-id-form",onSubmit:N,children:[e.jsx("label",{htmlFor:"gist-id",children:"Gist id:"}),e.jsx("input",{type:"text",className:"gist-id-input",id:"gist-id",name:"gist-id",list:"gist-list",placeholder:n.gist.gistIdPlaceholder,required:!0,...L},"gist-id"),e.jsx("input",{className:"button",type:"submit"}),s]})]})}},[a,x,n.gist.newGistTip,n.gist.newGistRepoButton,n.gist.gistIdPlaceholder,b,N]),D=React.useMemo(()=>{if(r!==null){const t=(s,i)=>e.jsxs("article",{className:"file-item",children:[e.jsx("section",{className:"file-content",children:s.content}),e.jsx("hr",{}),e.jsxs("section",{className:"file-bar",children:[e.jsx("span",{className:"file-title",children:s.filename}),e.jsxs("span",{className:"file-action",children:[e.jsx("a",{className:"file-load",href:G(C.editor),"data-key":i,children:e.jsx(J,{})}),e.jsx("a",{className:"file-load",href:G(C.synchronizer),"data-key":i,children:e.jsx(P,{})})]})]})]},s.raw_url);return r.length===0?e.jsx("section",{className:"gist-no-data",children:e.jsx(B,{})}):e.jsx("section",{className:"file-list",onClick:I,children:r.map(t)})}},[r,I]);return e.jsxs("div",{className:"gist",children:[e.jsx(O,{}),E||A||D||e.jsx(W,{})]})},W=()=>e.jsx("section",{className:"gist-loading",children:e.jsx(z,{})});export{X as Gist};
